# 个人网站功能模块详细设计文档

## 开发标准与规范

### 技术标准要求
- **严格遵循Hyperf框架标准**：所有后端代码必须符合Hyperf框架的设计规范和最佳实践
- **遵守PHP开发官方标准**：遵循PSR-1、PSR-2、PSR-4、PSR-12等PHP标准规范
- **严格遵循Next.js框架标准**：所有前端代码必须符合Next.js框架的设计规范和最佳实践
- **遵守JavaScript/TypeScript开发标准**：遵循ESLint、Prettier等代码规范工具推荐的标准
- **组件库标准**：使用符合行业标准的UI组件库，确保可访问性和响应式设计
- **代码质量要求**：代码需具备良好的可读性、可维护性和可扩展性
- **安全标准**：遵循OWASP安全编码规范，确保应用安全性

### Hyperf框架规范遵循
- 采用Hyperf推荐的分层架构设计
- 使用Hyperf的依赖注入容器管理服务
- 遵循Hyperf的协程编程模型
- 集成Hyperf的标准中间件体系
- 使用Hyperf官方推荐的组件和扩展

### PHP标准规范遵循
- PSR-1 (基本编码标准)
- PSR-2 (编码风格指南)
- PSR-4 (自动加载规范)
- PSR-12 (编码风格扩展)
- 遵循PHP安全最佳实践

### Next.js框架规范遵循
- 采用Next.js推荐的App Router架构
- 遵循Next.js的文件系统路由规范
- 使用Next.js的数据获取方法(getServerSideProps, getStaticProps等)
- 遵循Next.js的SEO最佳实践
- 集成Next.js的性能优化特性

### JavaScript/TypeScript标准规范遵循
- ECMAScript 2020+语法规范
- TypeScript类型安全规范
- ESLint代码质量检查
- Prettier代码格式化标准
- React Hooks最佳实践

## 1. 前端用户界面详细设计

### 1.1 设计规范与视觉风格

#### 视觉设计标准
- **背景色**：统一使用深灰色背景 (#1a1a1a)
- **字体颜色**：纯白色字体 (#ffffff)
- **链接颜色**：浅绿色链接 (#00ff99)
- **辅助色**：深蓝色 (#003366) 用于按钮和重要元素
- **强调色**：橙色 (#ff6600) 用于重要提示和警告

#### UI风格定位
- **整体风格**：简约+少量科技感
- **设计原则**：
  - 简洁明了的布局结构
  - 充分的留白空间
  - 适度的科技元素（如微妙的渐变、投影效果）
  - 响应式设计适配各种设备
  - 一致的交互体验

#### 字体规范
- **中文字体**：思源黑体、苹方、微软雅黑
- **英文字体**：Roboto、Helvetica Neue、Arial
- **字号规范**：
  - 标题：24-32px
  - 副标题：18-22px
  - 正文：14-16px
  - 辅助文字：12-14px

#### 间距规范
- **页面边距**：24px（大屏）、16px（中屏）、12px（小屏）
- **模块间距**：32px（大屏）、24px（中屏）、16px（小屏）
- **元素间距**：8px的倍数原则

### 1.1 首页模块

#### 功能描述
首页是用户访问网站的第一个页面，用于展示个人简介、最新博客、精选作品等信息。

#### 页面元素
- 个人头像和基本信息展示
- 个人简介内容（支持Markdown格式）
- 最新博客文章预览（显示3-5篇）
- 精选作品展示（显示3-5个）
- 社交媒体链接
- 网站导航菜单

#### 视觉设计
- 采用深灰色背景和白色字体的对比设计
- 个人头像使用圆形设计，带有微妙的阴影效果
- 导航菜单使用浅绿色链接，hover时有颜色过渡效果
- 博客和作品预览卡片采用简约的卡片设计，带有科技感的边框
- 社交媒体图标使用浅绿色，保持整体视觉统一

#### 交互设计
- 响应式布局，适配不同设备屏幕
- 点击博客标题跳转到博客详情页
- 点击作品图片跳转到作品详情页
- 导航菜单支持移动端折叠显示
- 悬停效果：卡片轻微上浮，链接颜色过渡动画

### 1.2 博客模块

#### 功能描述
博客模块用于展示个人撰写的技术文章、生活感悟等内容，支持分类和标签筛选。

#### 页面结构
- 博客列表页面
  - 分类导航栏
  - 标签云展示
  - 博客文章列表（带分页）
  - 筛选条件显示区域
- 博客详情页面
  - 文章标题和发布信息
  - Markdown内容渲染区域
  - 标签显示
  - 评论区域
  - 上下篇文章导航

#### 视觉设计
- 博客列表采用卡片式布局，每张卡片有科技感的边框和阴影
- 分类导航栏使用深蓝色背景，白色字体
- 标签云中的标签使用浅绿色，hover时有颜色变化
- 博客详情页标题使用大号字体，配有下划线装饰
- 代码块使用深色背景，语法高亮显示
- 评论区域采用简约设计，区分用户评论和作者回复

#### 核心功能
- 分类筛选：按博客分类过滤文章
- 标签筛选：按标签过滤文章
- 组合筛选：支持分类+标签组合筛选
- 搜索功能：按关键字搜索博客内容
- Markdown渲染：支持代码高亮、数学公式等
- 评论功能：会员用户可发表评论

#### 数据展示
- 博客列表显示标题、摘要、发布时间、分类、标签
- 博客详情显示完整内容、作者信息、发布时间、阅读数等

### 1.3 作品模块

#### 功能描述
作品模块用于展示个人的项目作品、设计作品等，支持分类浏览。

#### 页面结构
- 作品列表页面
  - 分类导航栏
  - 作品网格展示
  - 筛选条件显示
- 作品详情页面
  - 作品标题和描述
  - 作品图片展示（支持轮播）
  - 项目链接
  - 技术栈信息

#### 视觉设计
- 作品网格采用响应式布局，图片展示区域带有科技感的边框
- 分类导航栏与博客模块保持一致的设计风格
- 作品图片展示区域支持lightbox效果，点击放大查看
- 项目链接使用浅绿色按钮，hover时有颜色过渡和轻微放大效果
- 技术栈标签采用简约的标签设计，背景为深蓝色，文字为白色

#### 核心功能
- 分类筛选：按作品分类过滤展示
- 网格布局：响应式作品展示
- 图片预览：支持大图查看
- 外链跳转：跳转到项目在线地址

#### 数据展示
- 作品列表显示封面图、标题、简短描述、分类
- 作品详情显示完整描述、多张图片、技术信息等

### 1.4 笔记模块

#### 功能描述
笔记模块以脑图形式展示个人学习笔记，不提供传统列表视图。

#### 页面结构
- 脑图根节点列表页面
  - 根节点卡片展示（标题+脑图截图）
  - 创建新脑图按钮
  - 搜索功能
- 脑图详情页面
  - 交互式脑图展示区域
  - 节点详情查看面板
  - 工具栏（缩放、全屏、导出等）

#### 视觉设计
- 脑图根节点卡片采用科技感设计，带有微妙的渐变背景
- 脑图截图区域有边框装饰，hover时显示放大效果
- 脑图详情页面采用深色背景，节点使用不同颜色区分类型
- 节点连线使用浅绿色，与整体视觉风格保持一致
- 工具栏按钮使用简约设计，图标清晰易懂

#### 核心功能
- 脑图展示：D3.js实现交互式脑图
- 双向链接：笔记间建立关联关系
- Markdown编辑：支持Markdown格式笔记内容
- 多根节点：支持创建多个独立脑图
- 节点操作：创建、编辑、删除节点

#### 数据展示
- 根节点列表以卡片形式展示标题、截图、节点数
- 脑图详情以图形化方式展示节点关系

### 1.5 联系模块

#### 功能描述
联系模块提供用户与网站主人沟通的渠道。

#### 页面结构
- 联系表单
  - 姓名输入框
  - 邮箱输入框
  - 主题选择下拉框
  - 消息内容文本域
  - 提交按钮
- 联系信息展示
  - 社交媒体链接
  - 邮箱地址
  - 其他联系方式

#### 视觉设计
- 联系表单采用简约设计，输入框使用深色背景和白色边框
- 提交按钮使用浅绿色背景，hover时颜色加深并有轻微放大效果
- 社交媒体图标使用浅绿色，保持整体视觉统一
- 联系信息区域采用卡片式布局，配有科技感的装饰元素

#### 核心功能
- 表单验证：前端验证用户输入
- 邮件发送：后端处理表单并发送邮件
- 信息展示：展示多种联系方式

### 1.6 用户系统模块

#### 功能描述
用户系统提供用户注册、登录、个人资料管理等功能。

#### 页面结构
- 登录页面
  - 用户名/邮箱输入框
  - 密码输入框
  - 登录按钮
  - 忘记密码链接
  - 注册链接
- 注册页面
  - 用户名输入框
  - 邮箱输入框
  - 密码输入框
  - 确认密码输入框
  - 注册按钮
  - 登录链接
- 个人资料页面
  - 头像上传
  - 基本信息编辑
  - 密码修改
  - 注销登录按钮

#### 视觉设计
- 登录/注册页面采用居中布局，背景使用深灰色渐变
- 输入框使用深色背景和浅绿色边框，focus时边框颜色加深
- 登录/注册按钮使用浅绿色背景，hover时有颜色过渡效果
- 忘记密码和注册链接使用浅绿色，保持整体视觉统一
- 个人资料页面采用卡片式布局，各个功能区域清晰分隔

#### 核心功能
- 用户认证：JWT令牌验证用户身份
- 权限控制：根据用户角色显示不同功能
- 个人资料管理：用户可更新个人信息
- 会话管理：支持多设备登录管理

### 1.7 用户行为分析模块

#### 功能描述
用户行为分析模块用于收集、分析和展示用户在网站上的行为数据，帮助了解用户来源、访问内容、兴趣偏好以及周期性行为模式。

#### 页面结构
- 数据概览页面
  - 实时访客统计
  - 流量来源分析
  - 热门内容排行
  - 用户活跃度趋势
- 用户行为详情页面
  - 用户访问路径分析
  - 内容兴趣度分析
  - 停留时间统计
  - 跳出率分析
- 周期性行为分析页面
  - 每周行为模式
  - 季度行为趋势
  - 半年度行为总结
  - 年度行为报告

#### 核心功能
- **流量来源追踪**：
  - 直接访问统计
  - 搜索引擎来源分析
  - 社交媒体引流分析
  - 外部链接引入统计
- **内容访问分析**：
  - 页面浏览量统计
  - 用户访问路径追踪
  - 内容停留时间分析
  - 热门内容识别
- **兴趣偏好识别**：
  - 分类内容偏好分析
  - 标签兴趣度排序
  - 个性化内容推荐
  - 用户群体细分
- **周期性行为洞察**：
  - 每周访问模式分析（工作日vs周末）
  - 季度行为趋势追踪
  - 半年度行为变化总结
  - 年度行为报告生成

#### 数据收集机制
- **前端埋点**：
  - 页面访问事件追踪
  - 用户点击行为记录
  - 停留时间计算
  - 滚动深度监测
- **前端缓存策略**：
  - 使用IndexedDB作为本地缓存存储
  - 支持离线数据收集
  - 数据持久化保障
  - 自动清理过期数据
- **数据上报机制**：
  - 定时批量上报缓存数据
  - 网络状态检测和重试机制
  - 上报失败数据的重新入队
  - 支持手动触发立即上报

#### 前端IndexedDB缓存实现
- **数据库设计**：
  - 数据库名称：user_behavior_analytics
  - 对象存储名称：events
  - 主键：自增ID
  - 索引：时间戳、事件类型、页面URL
- **数据结构**：
  - event_id: 事件唯一标识
  - event_type: 事件类型（page_view, click, scroll等）
  - timestamp: 事件发生时间戳
  - page_url: 页面URL
  - user_agent: 用户代理信息
  - referrer: 来源页面
  - session_id: 会话ID
  - user_id: 用户ID（如果已登录）
  - additional_data: 额外数据（JSON格式）
- **缓存策略**：
  - 最大缓存条数限制（建议1000条）
  - 最大缓存时间限制（建议7天）
  - 定时清理过期数据
  - 内存不足时的清理机制

#### 数据安全与隐私保护
- **数据存储安全**：
  - IndexedDB数据存储在用户本地浏览器中，与其他网站隔离
  - 数据仅在同一域名下可访问，遵循同源策略
  - 不存储敏感个人信息，如密码、银行卡号等
- **数据传输安全**：
  - 所有数据上报通过HTTPS加密传输
  - 敏感信息在传输前进行脱敏处理
  - 支持数据签名验证，防止数据篡改
- **数据访问控制**：
  - 仅网站前端代码可访问IndexedDB数据
  - 不同子域名间数据隔离
  - 支持用户手动清除本地缓存数据
- **隐私保护措施**：
  - 遵守GDPR等数据保护法规
  - 明确告知用户数据收集目的和范围
  - 提供用户数据删除和导出功能
  - 支持用户禁用数据收集功能

#### 后端处理流程
- **数据接收**：
  - 采用先缓存后批量写入策略
  - 使用Redis作为临时缓存存储
  - 定时批量写入MySQL数据库
  - 支持高并发场景下的数据收集
- **数据处理**：
  - 埋点数据先写入Redis队列
  - 后台任务定时从队列中批量读取数据
  - 批量处理并写入MySQL数据库
  - 处理失败的数据重新入队或记录错误日志

#### 性能优化策略
- **前端优化**：
  - IndexedDB异步操作避免阻塞主线程
  - 批量写入减少I/O操作
  - 合理的缓存清理策略
  - 网络状态检测避免无效请求
- **后端优化**：
  - 批量写入数据库减少I/O操作
  - 可配置的批量大小和处理间隔
  - 异步处理避免阻塞主线程
- **限流保护**：
  - 控制数据收集频率
  - 防止异常流量冲击系统
  - 支持动态调整处理策略

#### 视觉设计
- 数据概览页面采用仪表板设计，使用图表和卡片展示关键指标
- 行为分析图表使用浅绿色和深蓝色配色，与整体视觉风格保持一致
- 时间序列图表支持多种时间维度切换（日、周、月、季度、年度）
- 报告页面采用简洁的排版，重点数据突出显示

#### 数据隐私保护
- 严格遵守GDPR等数据保护法规
- 用户身份信息匿名化处理
- 提供用户数据删除功能
- 明确的数据收集和使用说明
- **前端数据安全**：
  - IndexedDB数据遵循同源策略，防止跨站访问
  - 不存储敏感个人信息在本地
  - 支持用户手动清除本地缓存
  - 数据传输采用HTTPS加密
- **后端数据安全**：
  - 敏感数据加密存储
  - 访问日志记录和监控
  - 数据备份和恢复机制
  - 定期安全审计

## 2. 后台管理系统详细设计

### 2.0 模块位置
- 后台首页：/admin
- 各功能模块子路径：/admin/{module}
- 项目目录：admin/
- 开发环境：Docker容器运行（支持热重载）

### 2.1 仪表板模块

#### 功能描述
仪表板提供网站整体运行状态的概览信息。

#### 页面元素
- 数据统计卡片
  - 用户总数
  - 博客文章数
  - 作品数量
  - 笔记节点数
  - 评论总数
- 图表展示
  - 用户增长趋势图
  - 内容发布统计图
  - 访问量统计图
- 最新活动列表
  - 新用户注册记录
  - 新内容发布记录
  - 新评论记录

### 2.2 用户管理模块

#### 功能描述
用户管理模块用于管理系统中的所有用户账户。

#### 页面结构
- 用户列表页面
  - 用户表格（ID、用户名、邮箱、角色、状态、注册时间）
  - 搜索和筛选功能
  - 批量操作按钮
- 用户详情页面
  - 用户基本信息
  - 账户状态管理
  - 角色分配
  - 操作记录

#### 核心功能
- 用户列表查看和搜索
- 用户状态管理（启用/禁用）
- 用户角色分配
- 用户信息编辑
- 用户删除（软删除）

### 2.3 博客管理模块

#### 功能描述
博客管理模块用于创建、编辑、删除博客文章。

#### 页面结构
- 博客列表页面
  - 博客表格（标题、分类、标签、状态、发布时间）
  - 分类筛选
  - 状态筛选
  - 搜索功能
- 博客编辑页面
  - 标题输入框
  - 分类选择下拉框
  - 标签选择/创建
  - Markdown编辑器
  - 文章状态设置
  - 发布时间设置

#### 核心功能
- 博客文章增删改查
- 分类管理（增删改查）
- 标签管理（增删改查）
- 文章状态管理（草稿/发布）
- Markdown编辑器支持

### 2.4 作品管理模块

#### 功能描述
作品管理模块用于管理系统中的作品信息。

#### 页面结构
- 作品列表页面
  - 作品表格（标题、分类、状态、创建时间）
  - 分类筛选
  - 搜索功能
- 作品编辑页面
  - 标题输入框
  - 分类选择下拉框
  - 描述文本域
  - 图片上传
  - 项目链接输入框
  - 技术栈标签

#### 核心功能
- 作品信息增删改查
- 分类管理（增删改查）
- 图片上传和管理
- 外链管理

### 2.5 笔记管理模块

#### 功能描述
笔记管理模块用于管理脑图笔记系统。

#### 页面结构
- 脑图根节点列表
  - 根节点表格（标题、描述、节点数、创建时间）
  - 创建新脑图按钮
- 脑图编辑页面
  - 脑图可视化编辑器
  - 节点属性编辑面板
  - 链接管理面板
- 节点详情页面
  - Markdown内容编辑器
  - 链接关系管理
  - 节点属性设置

#### 核心功能
- 脑图根节点管理
- 脑图节点编辑
- 双向链接管理
- Markdown内容编辑
- 脑图导出功能

### 2.6 评论管理模块

#### 功能描述
评论管理模块用于审核和管理用户评论。

#### 页面结构
- 评论列表页面
  - 评论表格（内容、作者、关联内容、状态、时间）
  - 状态筛选（待审核/已审核/已拒绝）
  - 搜索功能
- 评论详情页面
  - 评论内容展示
  - 关联内容预览
  - 状态操作按钮

#### 核心功能
- 评论审核（通过/拒绝）
- 评论删除
- 评论状态管理
- 批量操作支持

### 2.7 系统配置模块

#### 功能描述
系统配置模块用于管理系统的基本配置参数。

#### 页面结构
- 基本配置页面
  - 网站名称设置
  - 网站描述设置
  - Logo上传
  - favicon上传
- SEO配置页面
  - Meta标签设置
  - 关键词设置
  - 描述设置
- 社交配置页面
  - 社交媒体链接设置
  - 联系方式设置

#### 核心功能
- 网站基本信息配置
- SEO参数配置
- 社交媒体链接管理
- 配置参数实时生效

### 2.8 用户行为分析管理模块

#### 功能描述
用户行为分析管理模块用于在后台管理系统中查看和管理用户行为分析数据，生成各种维度的分析报告。

#### 页面结构
- 分析仪表板页面
  - 实时数据概览
  - 关键指标卡片
  - 趋势图表展示
- 数据详情页面
  - 流量来源详细分析
  - 用户行为路径查看
  - 内容访问统计详情
- 报告生成页面
  - 自定义报告生成
  - 报告模板管理
  - 报告导出功能
- 设置管理页面
  - 数据收集规则配置
  - 隐私保护设置
  - 分析维度管理

#### 核心功能
- **数据可视化展示**：
  - 实时数据仪表板
  - 多维度图表分析
  - 趋势对比展示
  - 异常数据预警
- **报告生成与导出**：
  - 自动生成周期性报告
  - 自定义报告模板
  - 多格式报告导出（PDF、Excel、CSV）
  - 报告定时发送功能
- **数据分析工具**：
  - 用户群体细分工具
  - 行为路径分析工具
  - 转化漏斗分析
  - 留存率分析
- **配置管理**：
  - 数据收集规则设置
  - 隐私保护策略配置
  - 分析维度自定义
  - 报告生成计划设置

#### 性能优化策略
- **数据查询优化**：
  - 使用Redis缓存热点数据
  - 数据库索引优化
  - 分页查询避免大数据量加载
- **批量处理机制**：
  - 埋点数据先缓存后批量写入
  - 异步处理避免阻塞用户操作
  - 支持高并发数据收集场景
- **资源管理**：
  - 合理的缓存过期策略
  - 数据库连接池配置
  - 内存使用监控和优化

#### 视觉设计
- 后台分析界面采用专业数据可视化设计
- 图表配色与整体后台管理系统保持一致
- 数据表格支持排序、筛选和导出
- 报告模板界面提供直观的拖拽式编辑

## 3. 后端API服务详细设计

### 3.1 用户认证API

#### 接口列表
- 用户注册接口
  - 请求方式：POST
  - 请求路径：/api/auth/register
  - 请求参数：用户名、邮箱、密码
  - 响应数据：用户信息、JWT令牌
- 用户登录接口
  - 请求方式：POST
  - 请求路径：/api/auth/login
  - 请求参数：用户名/邮箱、密码
  - 响应数据：用户信息、JWT令牌
- 用户信息获取接口
  - 请求方式：GET
  - 请求路径：/api/user/profile
  - 请求头：Authorization: Bearer {token}
  - 响应数据：用户详细信息
- 用户信息更新接口
  - 请求方式：POST
  - 请求路径：/api/user/profile/update
  - 请求头：Authorization: Bearer {token}
  - 请求参数：可更新的用户信息
  - 响应数据：更新后的用户信息

### 3.2 内容管理API

#### 博客相关接口
- 博客列表获取接口
  - 请求方式：GET
  - 请求路径：/api/blog/posts
  - 查询参数：分类ID、标签ID、页码、每页数量
  - 响应数据：博客列表、分页信息
- 博客详情获取接口
  - 请求方式：GET
  - 请求路径：/api/blog/posts/detail
  - 查询参数：博客ID
  - 响应数据：博客详细信息
- 博客创建接口
  - 请求方式：POST
  - 请求路径：/api/blog/posts/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：标题、内容、分类ID、标签IDs等
  - 响应数据：创建的博客信息
- 博客更新接口
  - 请求方式：POST
  - 请求路径：/api/blog/posts/update
  - 请求头：Authorization: Bearer {token}
  - 请求参数：博客ID、可更新的博客信息
  - 响应数据：更新后的博客信息
- 博客删除接口
  - 请求方式：POST
  - 请求路径：/api/blog/posts/delete
  - 请求头：Authorization: Bearer {token}
  - 请求参数：博客ID
  - 响应数据：操作结果

#### 作品相关接口
- 作品列表获取接口
  - 请求方式：GET
  - 请求路径：/api/portfolio/items
  - 查询参数：分类ID、页码、每页数量
  - 响应数据：作品列表、分页信息
- 作品详情获取接口
  - 请求方式：GET
  - 请求路径：/api/portfolio/items/detail
  - 查询参数：作品ID
  - 响应数据：作品详细信息
- 作品创建接口
  - 请求方式：POST
  - 请求路径：/api/portfolio/items/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：标题、描述、分类ID、图片等
  - 响应数据：创建的作品信息
- 作品更新接口
  - 请求方式：POST
  - 请求路径：/api/portfolio/items/update
  - 请求头：Authorization: Bearer {token}
  - 请求参数：作品ID、可更新的作品信息
  - 响应数据：更新后的作品信息
- 作品删除接口
  - 请求方式：POST
  - 请求路径：/api/portfolio/items/delete
  - 请求头：Authorization: Bearer {token}
  - 请求参数：作品ID
  - 响应数据：操作结果

#### 笔记相关接口
- 笔记列表获取接口（脑图根节点）
  - 请求方式：GET
  - 请求路径：/api/notes/mindmap/roots
  - 响应数据：脑图根节点列表
- 笔记详情获取接口
  - 请求方式：GET
  - 请求路径：/api/notes/detail
  - 查询参数：笔记ID
  - 响应数据：笔记详细信息（Markdown格式）
- 笔记创建接口
  - 请求方式：POST
  - 请求路径：/api/notes/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：标题、内容、公开状态等
  - 响应数据：创建的笔记信息
- 笔记更新接口
  - 请求方式：POST
  - 请求路径：/api/notes/update
  - 请求头：Authorization: Bearer {token}
  - 请求参数：笔记ID、可更新的笔记信息
  - 响应数据：更新后的笔记信息
- 笔记删除接口
  - 请求方式：POST
  - 请求路径：/api/notes/delete
  - 请求头：Authorization: Bearer {token}
  - 请求参数：笔记ID
  - 响应数据：操作结果

#### 评论相关接口
- 评论列表获取接口
  - 请求方式：GET
  - 请求路径：/api/comments
  - 查询参数：内容ID、状态、页码、每页数量
  - 响应数据：评论列表、分页信息
- 评论创建接口
  - 请求方式：POST
  - 请求路径：/api/comments/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：内容ID、评论内容等
  - 响应数据：创建的评论信息
- 评论审核接口
  - 请求方式：POST
  - 请求路径：/api/comments/review
  - 请求头：Authorization: Bearer {token}
  - 请求参数：评论ID、审核状态
  - 响应数据：更新后的评论信息
- 评论删除接口
  - 请求方式：POST
  - 请求路径：/api/comments/delete
  - 请求头：Authorization: Bearer {token}
  - 请求参数：评论ID
  - 响应数据：操作结果

### 3.3 脑图管理API

#### 接口列表
- 脑图根节点列表接口
  - 请求方式：GET
  - 请求路径：/api/notes/mindmap/roots
  - 响应数据：脑图根节点列表
- 脑图根节点创建接口
  - 请求方式：POST
  - 请求路径：/api/notes/mindmap/roots/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：标题、描述等
  - 响应数据：创建的根节点信息
- 脑图数据获取接口
  - 请求方式：GET
  - 请求路径：/api/notes/mindmap/roots/data
  - 查询参数：根节点ID
  - 响应数据：脑图节点和链接数据
- 脑图节点创建接口
  - 请求方式：POST
  - 请求路径：/api/notes/mindmap/nodes/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：节点信息、位置坐标等
  - 响应数据：创建的节点信息
- 脑图节点更新接口
  - 请求方式：POST
  - 请求路径：/api/notes/mindmap/nodes/update
  - 请求头：Authorization: Bearer {token}
  - 请求参数：节点ID、可更新的节点信息
  - 响应数据：更新后的节点信息
- 脑图链接创建接口
  - 请求方式：POST
  - 请求路径：/api/notes/mindmap/links/create
  - 请求头：Authorization: Bearer {token}
  - 请求参数：起始节点ID、目标节点ID等
  - 响应数据：创建的链接信息

### 3.4 用户行为分析API

#### 接口列表
- 用户行为数据收集接口
  - 请求方式：POST
  - 请求路径：/api/analytics/collect
  - 请求头：Authorization: Bearer {token}（可选）
  - 请求参数：用户行为数据（页面URL、停留时间、点击位置等）
  - 响应数据：收集结果
- 实时数据获取接口
  - 请求方式：GET
  - 请求路径：/api/analytics/realtime
  - 查询参数：时间范围、数据类型
  - 响应数据：实时访客数据、当前活跃用户等
- 流量来源分析接口
  - 请求方式：GET
  - 请求路径：/api/analytics/traffic-sources
  - 查询参数：时间范围、来源类型
  - 响应数据：各来源流量统计数据
- 内容访问统计接口
  - 请求方式：GET
  - 请求路径：/api/analytics/content-stats
  - 查询参数：时间范围、内容类型、排序方式
  - 响应数据：内容访问量、停留时间等统计信息
- 用户兴趣分析接口
  - 请求方式：GET
  - 请求路径：/api/analytics/user-interests
  - 查询参数：用户ID（可选）、时间范围、分析维度
  - 响应数据：用户兴趣偏好分析结果
- 周期性行为分析接口
  - 请求方式：GET
  - 请求路径：/api/analytics/periodic-behavior
  - 查询参数：周期类型（周/季度/半年度/年度）、时间范围
  - 响应数据：周期性行为模式分析结果
- 报告生成接口
  - 请求方式：POST
  - 请求路径：/api/analytics/generate-report
  - 请求头：Authorization: Bearer {token}
  - 请求参数：报告类型、时间范围、格式要求
  - 响应数据：生成的报告文件或下载链接
- 批量数据上报接口
  - 请求方式：POST
  - 请求路径：/api/analytics/batch-collect
  - 请求头：Authorization: Bearer {token}（可选）
  - 请求参数：批量用户行为数据数组
  - 响应数据：批量处理结果

#### 数据处理架构
- **数据收集层**：
  - 埋点数据通过HTTP API接收（支持单条和批量）
  - 数据验证和初步处理
  - 写入Redis缓存队列
- **数据安全层**：
  - 数据传输采用HTTPS加密
  - 敏感信息脱敏处理
  - 数据签名验证防止篡改
  - 访问频率限制防止滥用
- **数据缓存层**：
  - 使用Redis作为高速缓存
  - 支持高并发数据写入
  - 数据持久化保障
- **数据处理层**：
  - 后台定时任务批量处理缓存数据
  - 批量写入MySQL数据库
  - 异常数据处理和重试机制
- **数据查询层**：
  - 热点数据缓存到Redis
  - 复杂查询优化
  - 分页和索引优化

#### 安全与合规
- **数据传输安全**：
  - 所有API接口采用HTTPS加密传输
  - 敏感数据在传输过程中进行加密
  - 支持JWT令牌验证身份
- **数据存储安全**：
  - 敏感数据加密存储
  - 数据库访问权限控制
  - 定期数据备份机制
- **访问控制**：
  - IP频率限制防止恶意请求
  - 用户身份验证和授权
  - API访问日志记录
- **合规性**：
  - 遵守GDPR等数据保护法规
  - 用户数据删除和导出支持
  - 隐私政策明确告知
- **API设计规范**：
  - 仅使用GET和POST两种HTTP方法
  - GET用于数据查询操作
  - POST用于数据创建、更新和删除操作
  - 通过URL路径和参数区分不同操作

#### 性能优化策略
- **批量写入机制**：
  - 设置合理的批量大小（建议100-500条）
  - 配置适当的处理间隔（建议5-10秒）
  - 支持动态调整批量处理参数
- **缓存优化**：
  - Redis缓存热点查询结果
  - 设置合理的缓存过期时间
  - 缓存预热机制
- **数据库优化**：
  - 合理的表结构设计和索引
  - 分区表处理大数据量
  - 连接池配置优化
- **前端优化**：
  - 支持IndexedDB本地缓存
  - 批量上报减少网络请求
  - 网络状态检测和重试机制

## 4. 性能优化模块详细设计

### 4.1 协程连接池配置

#### MySQL连接池配置
- 最小连接数：1
- 最大连接数：20-50（根据ECS资源配置调整）
- 连接超时时间：10秒
- 等待超时时间：3秒
- 心跳检测：-1（不启用）
- 最大空闲时间：60秒

#### Redis连接池配置
- 最小连接数：1
- 最大连接数：20-50（根据ECS资源配置调整）
- 连接超时时间：10秒
- 等待超时时间：3秒
- 心跳检测：-1（不启用）
- 最大空闲时间：60秒

### 4.2 布隆过滤器实现

#### 应用场景
- 快速过滤不存在的资源请求
- 减少后端处理压力
- 降低数据库查询次数

#### 技术实现
- 使用CRC32哈希函数
- 位数组大小：1,000,000
- 哈希函数数量：3个
- 支持元素添加和可能存在性检查

### 4.3 限速机制配置

#### 限速策略
- 每个IP地址每分钟最多60次请求
- 使用Redis滑动窗口算法实现
- 支持自定义限速规则

#### 技术实现
- 使用hyperf/rate-limit组件
- Redis存储请求计数
- 支持自定义限速中间件

### 4.4 JWT令牌缓存策略

#### 缓存设计
- JWT令牌信息存储到Redis
- 使用哈希结构存储令牌详情
- 设置与JWT令牌相同的过期时间

#### 性能优化
- 验证时直接从Redis查询
- 避免重复计算和数据库查询
- 支持令牌主动失效

### 4.5 代码分层架构

#### 架构概述
后端API项目采用经典的分层架构设计，基于Hyperf框架的特性，确保代码结构清晰、职责分明、易于维护和扩展。

#### 分层详细设计

##### 1. 控制器层（Controller Layer）
- **职责**：
  - 接收和解析HTTP请求
  - 验证请求参数
  - 调用服务层处理业务逻辑
  - 构造和返回HTTP响应
- **实现要点**：
  - 使用Hyperf的注解路由功能
  - 实现请求参数验证
  - 处理异常并返回统一格式的错误响应
  - 不包含业务逻辑代码

##### 2. 服务层（Service Layer）
- **职责**：
  - 实现核心业务逻辑
  - 处理事务管理
  - 协调多个数据访问对象的操作
  - 提供可重用的业务功能
- **实现要点**：
  - 业务逻辑与数据访问分离
  - 使用依赖注入管理服务依赖
  - 实现事务控制
  - 提供统一的业务接口

##### 3. 数据访问层（Repository/Model Layer）
- **职责**：
  - 负责与数据库交互
  - 封装数据查询和持久化操作
  - 使用Hyperf的ORM进行数据库操作
  - 提供数据对象的增删改查功能
- **实现要点**：
  - 使用Eloquent ORM或Hyperf Database组件
  - 实现数据模型和数据表映射
  - 提供常用的查询方法
  - 处理数据库连接和查询优化

##### 4. 中间件层（Middleware Layer）
- **职责**：
  - 处理跨切面关注点（如认证、限流、日志等）
  - 请求预处理和响应后处理
  - 权限验证和安全控制
- **实现要点**：
  - 使用Hyperf中间件机制
  - 实现JWT认证中间件
  - 实现限速中间件
  - 实现日志记录中间件

##### 5. 工具层（Util/Helper Layer）
- **职责**：
  - 提供通用的工具函数和辅助类
  - 处理文件操作、数据转换等通用功能
  - 实现第三方服务集成
- **实现要点**：
  - 提供静态工具方法
  - 实现常用的数据处理函数
  - 封装第三方库的使用

#### 参数映射与字段安全

##### 映射机制设计
为了保护数据库字段安全，系统采用多层映射机制来隔离前端参数与数据库字段：

1. **数据传输对象（DTO）**：
   - 控制器层使用DTO接收前端请求参数
   - DTO字段名与前端约定的参数名保持一致
   - 通过自动映射或手动转换将DTO转换为数据库实体

2. **视图对象（VO）**：
   - 数据库查询结果转换为VO对象返回给前端
   - VO字段名与前端期望的响应格式保持一致
   - 隐藏敏感字段和数据库真实结构

3. **字段映射服务**：
   - 提供统一的字段映射服务
   - 支持批量字段名转换
   - 实现字段白名单机制

##### 安全防护措施
- **字段隐藏**：数据库真实字段名不直接暴露给前端
- **参数验证**：严格验证前端传入的参数，只处理允许的字段
- **批量赋值防护**：避免直接将前端参数批量赋值给数据库实体
- **字段白名单**：定义允许操作的字段列表，拒绝未授权字段
- **数据脱敏**：对敏感数据进行脱敏处理后再返回给前端

#### 统一API响应封装

##### 响应格式设计
为了提供更好的开发体验和统一的错误处理机制，系统采用封装的API响应格式，同时支持HTTP状态码和业务码：

1. **成功响应格式**：
   ```json
   {
     "success": true,
     "code": 200,
     "message": "操作成功",
     "data": {
       // 具体业务数据
     },
     "timestamp": 1234567890,
     "request_id": "550e8400-e29b-41d4-a716-446655440000"
   }
   ```

2. **失败响应格式**：
   ```json
   {
     "success": false,
     "code": 400,
     "message": "参数验证失败",
     "data": {
       "errors": [
         {
           "field": "username",
           "message": "用户名不能为空"
         }
       ]
     },
     "timestamp": 1234567890,
     "request_id": "550e8400-e29b-41d4-a716-446655440000"
   }
   ```

##### 响应字段说明
- **success**：布尔值，表示请求是否成功
- **code**：业务码，表示具体业务操作的结果状态
- **message**：响应消息，提供人类可读的操作结果描述
- **data**：响应数据，包含具体的业务数据或错误详情
- **timestamp**：时间戳，记录响应生成时间
- **request_id**：请求ID，用于追踪和调试

##### 业务码规范
1. **成功状态码（200系列）**：
   - 200: 操作成功
   - 201: 创建成功
   - 204: 删除成功

2. **客户端错误（400系列）**：
   - 400: 请求参数错误
   - 401: 未授权访问
   - 403: 禁止访问
   - 404: 资源不存在
   - 422: 数据验证失败

3. **服务器错误（500系列）**：
   - 500: 服务器内部错误
   - 502: 网关错误
   - 503: 服务不可用

4. **自定义业务码**：
   - 10000-19999: 用户相关业务码
   - 20000-29999: 内容管理业务码
   - 30000-39999: 系统配置业务码

##### 实现机制
1. **响应封装器**：
   - 提供统一的响应构建工具类
   - 支持链式调用构建响应
   - 自动设置时间戳和请求ID

2. **异常处理**：
   - 统一异常处理中间件
   - 自动将异常转换为标准响应格式
   - 支持不同环境的错误信息展示

3. **HTTP状态码映射**：
   - 业务码与HTTP状态码自动映射
   - 确保HTTP层面的正确响应状态
   - 支持自定义映射规则

#### 分层架构优势
- **职责分离**：每层都有明确的职责，便于维护和扩展
- **代码复用**：服务层和工具层的代码可以在不同控制器中复用
- **易于测试**：各层可以独立进行单元测试
- **降低耦合**：层与层之间通过接口交互，降低耦合度
- **便于协作**：不同开发者可以并行开发不同层的代码
- **安全保障**：通过参数映射机制保护数据库字段安全

#### 目录结构规划
```
app/
├── Controller/          # 控制器层
├── Service/             # 服务层
├── Repository/          # 数据访问层
├── Middleware/          # 中间件层
├── Util/                # 工具层
├── Model/               # 数据模型
├── Dto/                 # 数据传输对象
├── Vo/                  # 视图对象
└── Exception/           # 自定义异常
```

