# 个人网站项目需求文档

## 1. 项目概述

### 1.1 项目目标
开发一个现代化的个人网站，包含面向公众的用户界面和后台管理系统，用于展示个人作品、博客、笔记等内容，并提供用户交互功能。

## 2. 技术架构与规范

### 2.1 技术栈选择
- **前端用户界面**：Next.js 14 (App Router)
- **后台管理系统**：hyperf-admin (Vue + Hyperf)
- **后端API服务**：Hyperf框架
- **数据库**：MySQL 8.0
- **缓存**：Redis 7
- **部署**：Docker + Docker Compose（本地开发）/ systemd（线上ECS）

### 2.2 开发规范要求

#### 后端开发规范
- **Hyperf框架规范**：
  - 采用Hyperf推荐的分层架构设计
  - 使用Hyperf的依赖注入容器管理服务
  - 遵循Hyperf的协程编程模型
  - 集成Hyperf的标准中间件体系
  - 使用Hyperf官方推荐的组件和扩展
- **PHP标准规范**：
  - PSR-1 (基本编码标准)
  - PSR-2 (编码风格指南)
  - PSR-4 (自动加载规范)
  - PSR-12 (编码风格扩展)
  - 遵循PHP安全最佳实践

#### 前端开发规范
- **Next.js框架规范**：
  - 采用Next.js推荐的App Router架构
  - 遵循Next.js的文件系统路由规范
  - 使用Next.js的数据获取方法(getServerSideProps, getStaticProps等)
  - 遵循Next.js的SEO最佳实践
  - 集成Next.js的性能优化特性
- **JavaScript/TypeScript标准规范**：
  - ECMAScript 2020+语法规范
  - TypeScript类型安全规范
  - ESLint代码质量检查
  - Prettier代码格式化标准
  - React Hooks最佳实践
- **UI组件库**：
  - 推荐使用Tailwind CSS作为CSS框架，结合自定义组件
  - 如需组件库，可考虑使用Radix UI、Headless UI等无样式组件库，配合Tailwind CSS实现自定义样式
  - 对于复杂组件，可选择Ant Design for React或Chakra UI（需确保与整体设计风格协调）

#### 通用规范
- **组件库标准**：使用符合行业标准的UI组件库，确保可访问性和响应式设计
- **代码质量要求**：代码需具备良好的可读性、可维护性和可扩展性
- **安全标准**：遵循OWASP安全编码规范，确保应用安全性
- **优先使用官方组件**：优先使用Hyperf、Next.js等框架提供的官方组件包，避免自行实现已有官方解决方案的功能

### 设计规范与视觉风格

#### 视觉设计标准
- **背景色**：统一使用深灰色背景 (#1a1a1a)
- **字体颜色**：纯白色字体 (#ffffff)
- **链接颜色**：浅绿色链接 (#00ff99)
- **辅助色**：深蓝色 (#003366) 用于按钮和重要元素
- **强调色**：橙色 (#ff6600) 用于重要提示和警告

#### UI风格定位
- **整体风格**：简约+少量科技感
- **设计原则**：
  - 简洁明了的布局结构
  - 充分的留白空间
  - 适度的科技元素（如微妙的渐变、投影效果）
  - 响应式设计适配各种设备
  - 一致的交互体验

#### 字体规范
- **中文字体**：思源黑体、苹方、微软雅黑
- **英文字体**：Roboto、Helvetica Neue、Arial
- **字号规范**：
  - 标题：24-32px
  - 副标题：18-22px
  - 正文：14-16px
  - 辅助文字：12-14px

#### 间距规范
- **响应式设计**：使用Tailwind CSS，元素间距采用响应式自动处理，适配移动端、平板、桌面端

## 3. 核心功能模块

### 3.1 前端用户界面

- **首页**：个人简介展示
- **博客页面**：支持分类和标签双层筛选，Markdown渲染
- **作品页面**：支持分类筛选
- **笔记页面**：完全以脑图形式展示，不提供传统列表视图，所有用户以只读方式访问
- **联系页面**：联系方式表单
- **用户系统**：注册/登录、个人资料、评论发布（会员）、RSS订阅，支持微信、支付宝第三方登录
- **社交媒体分享**：支持博客和作品内容分享到主流社交媒体平台
- **邮件服务集成**：集成邮件发送功能，支持通知、验证码等场景
- **用户体验优化**：页面加载骨架屏、无障碍访问支持

### 3.2 后台管理系统

基于hyperf-admin构建，包含以下功能模块：
- 仪表板：网站统计数据展示
- 用户管理：用户列表查看、权限分配、状态管理
- 博客管理：博客文章增删改查、标签管理、状态管理
- 作品管理：作品增删改查、分类管理
- 笔记管理：脑图根节点管理、节点编辑、双向链接管理
- 评论管理：评论审核、删除
- 用户分析：流量来源、内容访问、兴趣偏好、周期性行为
- 系统配置：网站参数设置

### 3.3 后端API服务

- 用户认证API（JWT + RBAC）
- 内容管理API（博客、作品、笔记、评论、RSS）
- 脑图API（根节点管理、节点编辑、链接管理）
- 性能优化中间件（布隆过滤器、限速、日志）

## 4. 用户权限体系

### 4.1 用户角色定义
- **管理员**：拥有所有权限，可以管理用户、内容、评论和系统配置
- **会员用户**：可管理个人资料、发表评论、浏览公开和会员专属内容、管理收藏（博客和笔记）、管理RSS订阅
- **访客用户**：仅可查看公开内容，访问个人中心自动跳转登录界面

### 4.2 权限控制机制
- **权限模型**：整合RACL（资源访问控制列表）实现细粒度权限控制
- **认证方式**：JWT令牌安全认证
- **中间件实现**：优先使用Hyperf框架内置组件，通过注解或类引用方式实现，避免自定义开发
- **核心中间件**：认证中间件、限流中间件、日志中间件

### 4.3 权限验证流程
- 未登录用户默认分配访客角色权限
- 已登录用户根据角色获取对应权限集
- 资源访问请求通过RACL中间件进行权限验证
- 实现权限缓存机制，减少重复验证开销

## 5. 技术特性

### 5.1 性能优化

- **协程连接池**：使用Hyperf官方的MySQL和Redis协程连接池组件，最大连接数20-50，避免高并发下连接数无限扩大
- **布隆过滤器**：快速过滤不存在的资源请求，减少后端处理压力（如有需要可使用官方提供的相关组件）
- **限速机制**：优先使用Hyperf官方的`hyperf/rate-limit`组件实现，防止恶意请求和DDoS攻击，保护服务器资源
- **日志系统**：
  - 使用Hyperf官方的日志组件，支持多渠道输出（文件、控制台、远程日志服务等）
  - 日志级别划分：DEBUG、INFO、WARNING、ERROR、CRITICAL
  - 请求日志：记录请求方法、路径、响应码、响应时间、客户端IP等信息
  - 业务日志：记录关键业务操作，如数据增删改查、权限变更等
  - 错误日志：详细记录异常信息，包括调用栈和上下文环境
  - 日志格式统一：包含时间戳、级别、模块、消息等字段
- **权限缓存**：实现权限缓存机制，减少重复的权限验证开销
- **SEO优化**：
  - 内容静态化
  - 结构化数据标记支持
  - 响应式设计对搜索引擎友好
- **前端优化**：
  - 页面加载骨架屏：使用库实现（如React Content Loader或Next.js内置骨架屏方案）
  - 无障碍访问(Accessibility)支持：遵循WCAG 2.1 AA级标准
- **监控与分析**：
  - 用户行为分析：优先采用框架内置组件或第三方组件，如无法满足则编码实现
  - 错误监控：优先采用框架内置组件或第三方组件，如Sentry、ELK等，如无法满足则编码实现

### 5.2 笔记系统特色

- 完全以脑图为核心，不提供传统列表视图
- 支持根节点列表展示（标题+脑图截图）
- 双向链接支持，实现笔记间关联
- Markdown格式存储和渲染
- 支持多个独立根节点
- **管理权限**：脑图和笔记的所有管理操作（创建、编辑、删除）仅限管理员在后端系统进行
- **前端展示**：前端用户（包括会员和访客）只能以只读方式查看脑图结构和笔记内容
- **交互流程**：用户在脑图界面浏览，点击具体笔记链接节点才会跳转到笔记详情页查看内容
- **分类体系**：脑图的根节点和各级子节点作为笔记的分类结构，形成层级化的笔记组织体系
- **节点类型**：脑图节点支持两种类型 - 子节点（继续扩展分类）和笔记链接（指向具体笔记）
- **版本控制**：
  - 存储方式：完整内容快照
  - 触发机制：定时自动保存
  - 对比功能：前后版本差异高亮显示，使用diff算法实现内容比较
  - 回滚功能：支持回滚到任意历史版本
  - 发布处理：笔记发布后删除临时版本，只保留发布过的版本
- **草稿功能**：在现有笔记表中添加status字段（'draft'/'published'）实现草稿管理

### 5.3 博客系统特色
- **Markdown编辑**：支持Markdown格式编辑和预览
- **分类标签**：支持多级分类和标签管理
- **评论互动**：支持用户评论和回复
- **草稿功能**：在现有博客表中添加status字段（'draft'/'published'）实现草稿管理

### 5.4 部署架构

- **本地开发环境**：Docker Compose编排后端服务（API、数据库、缓存等）和后台管理系统，独立容器运行，环境配置分离
- **前端开发**：使用本地Node.js开发环境，不包含在容器编排中
- **线上部署**：阿里云ECS单机部署，systemd管理服务启停，Nginx作为统一入口
- **配置管理**：通过环境变量分离配置，开发环境使用.env.development，生产环境使用.env.production

### 5.5 数据存储与监控优化

- **数据存储**：MySQL和Redis采用协程连接池管理连接
- **监控与分析**：
  - **用户行为分析**：优先采用框架内置组件或第三方组件，如无法满足则编码实现
  - **错误监控与报警机制**：优先采用框架内置组件或第三方组件，如Sentry、ELK等，如无法满足则编码实现
- **性能优化**：
  - **连接池参数调优**：MySQL和Redis连接池大小设置为20-50，根据实际负载调整
  - **数据库索引优化**：
    - 为用户表的username、email字段创建唯一索引
    - 为博客表的category_id、created_at、updated_at字段创建索引
    - 为笔记表的created_at、updated_at、status字段创建索引
    - 为评论表的user_id、post_id、created_at字段创建索引
    - 避免创建过多冗余索引，影响写入性能
  - **Redis缓存策略优化**：
    - 热点数据缓存：热门博客、作品内容缓存时间设置为1-24小时
    - 用户会话缓存：用户登录状态缓存时间设置为会话有效期
    - 权限缓存：用户权限信息缓存时间设置为30分钟
    - 使用缓存预热和缓存穿透/雪崩防护策略
  - **线上环境Nginx性能调优**：配置适当的工作进程数和连接数

## 6. 数据库设计

### 6.1 核心数据表

- **用户表**：存储用户基本信息、角色、状态，对应功能模块中的用户系统功能
- **博客表**：存储博客文章内容、状态（draft/published）、分类、标签关联，对应功能模块中的博客页面功能
- **作品表**：存储作品信息、图片链接、项目链接、分类，对应功能模块中的作品页面功能
- **笔记表**：存储笔记内容（Markdown格式）、状态（draft/published）、公开状态，对应功能模块中的笔记页面功能
- **笔记版本历史表**：存储笔记历史版本，包含版本ID、笔记ID、内容快照、标题快照、版本号、创建时间、创建人等字段，支持笔记版本控制功能
- **评论表**：存储用户评论、审核状态，对应功能模块中的评论功能
- **订阅表**：存储RSS订阅信息，对应功能模块中的RSS订阅功能
- **用户分析表**：存储行为事件、流量来源、访问记录、用户画像等，对应功能模块中的用户行为分析功能
- **联系表单表**：存储联系表单提交记录，包含姓名、邮箱、主题、内容、提交时间等字段，对应功能模块中的联系页面功能
- **系统配置表**：存储网站配置参数，包含配置项名称、配置值、描述等字段，对应功能模块中的系统配置功能

### 6.2 脑图相关表

- **脑图根节点表**：存储脑图根节点信息、截图路径
- **脑图节点表**：存储脑图节点信息、位置坐标、节点类型（子节点/笔记链接节点）、关联笔记ID（如果是笔记链接节点）
- **节点链接表**：存储节点间链接关系
- **笔记关联机制**：笔记只能通过脑图进行管理（仅限管理员）和访问（所有用户只读），确保数据的一致性和访问控制

### 6.3 分类标签表

- **博客分类表**：存储博客分类信息
- **博客标签表**：存储博客标签信息
- **博客标签关联表**：存储博客与标签的关联关系

## 7. API接口设计

### 7.1 用户认证接口

- 用户注册/登录接口，支持功能模块中的用户系统功能
- JWT令牌生成与验证接口，支持功能模块中的用户认证需求
- 用户信息获取/更新接口，支持功能模块中的个人资料管理功能

### 7.2 内容管理接口

- 博客文章增删改查接口，支持功能模块中的博客页面功能
- 作品集增删改查接口，支持功能模块中的作品页面功能
- 笔记增删改查接口，支持功能模块中的笔记页面功能
- 评论增删改查接口，支持功能模块中的评论功能
- RSS订阅接口，支持功能模块中的RSS订阅功能
- 联系表单提交接口，支持功能模块中的联系页面功能
- 社交媒体分享配置接口，支持功能模块中的社交媒体分享功能

### 7.3 脑图管理接口

- 脑图根节点管理接口，支持功能模块中的笔记页面脑图功能
- 脑图数据获取接口，支持功能模块中的脑图展示功能
- 节点间链接管理接口，支持功能模块中的双向链接功能

### 7.4 系统服务接口

- 邮件发送接口，支持功能模块中的邮件服务集成功能（通知、验证码等）
- 仪表板数据统计接口，支持功能模块中的仪表板功能
- 系统配置管理接口，支持功能模块中的系统配置功能

### 7.5 API设计规范

- **简化HTTP方法**：采用GET/POST简化操作类型，减少HTTP方法种类，便于前端统一处理
- **接口参数**：
  - **查询参数**：用于过滤、排序、分页等，符合Next.js数据获取模式
  - **请求体**：使用JSON格式，与Next.js的fetch API和Server Components数据获取兼容
  - **路径参数**：用于标识资源ID，支持Next.js的动态路由参数
  - **内容类型**：支持Content-Type: application/json
- **返回格式**：统一JSON格式响应，与Next.js的数据获取机制完全兼容
  - 成功响应：`{"code": 0, "message": "success", "data": {...}}`，适合Next.js Server Components和Client Components使用
  - 错误响应：`{"code": 错误码, "message": "错误信息", "data": null}`，便于Next.js错误边界和错误处理
  - 响应格式设计考虑了Next.js的数据流模式和TypeScript类型系统
- **版本控制**：
  - **路径版本化**：API路径中包含版本号，如`/api/v1/users`，确保API演进不影响现有客户端
  - **版本命名规则**：使用主版本号（v1, v2...）标识重大变更，确保兼容性管理
  - **兼容性保证**：同版本内API保证向后兼容，重大变更升级主版本号
  - **多模块版本策略**：后端API和后台管理系统API采用统一的版本控制机制
  - **版本迁移**：提供清晰的版本迁移指南，支持平滑升级
  - **版本弃用**：明确版本支持周期和弃用策略
- **分页规范**：统一使用page（页码）和limit（每页数量）参数，返回格式包含total（总数）、page（当前页）、limit（每页数量）、items（数据列表）
- **错误处理**：统一的错误码体系，清晰的错误信息描述
- **TypeScript支持**：提供API响应的TypeScript类型定义，方便前端类型安全开发
- **Next.js集成**：
  - 支持服务端数据获取（Server Components）
  - 提供适合客户端组件的数据获取方式
  - 考虑前端缓存策略的API设计

## 8. 部署与扩展

### 8.1 环境配置

- **配置管理**：通过环境变量分离配置，开发环境使用.env.development，生产环境使用.env.production
- **容器编排**：本地开发环境通过docker-compose.yml统一管理后端服务（API、数据库、缓存等）和后台管理系统，不包含前端项目
- **前端开发**：使用本地Node.js环境进行开发
- **服务管理**：线上环境使用systemd管理服务启停
- **反向代理**：线上环境使用Nginx作为统一入口和反向代理，配置SSL证书和安全加固

### 8.2 第三方服务集成

- **邮件服务**：集成邮件发送功能，支持通知、验证码等场景
- **社交媒体分享**：支持博客和作品内容分享到主流社交平台
- **第三方登录**：支持微信、支付宝登录，采用OAuth2.0协议确保授权安全

### 8.3 前端构建与部署规范

- **构建流程**：使用Next.js官方推荐的构建方式（`next build`）生成静态资源
- **优化策略**：
  - 代码分割（Code Splitting）
  - 懒加载（Lazy Loading）
  - 图片优化（Image Optimization）
  - 静态生成（Static Generation）和服务器端渲染（SSR）结合使用
- **环境配置**：使用.env.production进行生产环境配置
- **部署路径**：编译后的静态资源部署到Web服务器目录
- **CI/CD集成**：支持自动化构建和部署流程

## 9. 安全考虑

- **认证与授权**：JWT令牌安全存储和传输，实现细粒度的RBAC权限控制
- **数据安全**：用户密码加密存储，敏感信息过滤
- **攻击防护**：SQL注入防护、XSS攻击防护、CSRF攻击防护
- **访问控制**：访问频率限制，防止恶意请求和DDoS攻击
- **第三方登录安全**：微信、支付宝登录采用OAuth2.0协议，确保授权安全

## 10. 测试策略

### 10.1 后端测试

- **单元测试**：
  - 使用PHPUnit进行核心业务逻辑测试
  - 覆盖Model、Service、Utils等关键类和方法
  - 确保代码测试覆盖率不低于80%
- **集成测试**：
  - 使用Hyperf内置的HttpTestCase进行API接口测试
  - 测试数据库交互、缓存操作等核心功能
  - 验证中间件和拦截器的正确执行
- **性能测试**：
  - 使用性能测试工具对关键API进行压力测试
  - 验证连接池配置和性能优化措施的有效性

### 10.2 前端测试

- **单元测试**：
  - 使用Jest测试React组件和业务逻辑
  - 测试Hooks、Utils等核心功能
  - 确保代码测试覆盖率不低于70%
- **集成测试**：
  - 使用Cypress或Playwright进行端到端测试
  - 测试关键用户流程和交互场景
- **UI测试**：
  - 验证响应式设计在不同设备上的显示效果
  - 确保无障碍访问功能符合WCAG 2.1 AA级标准

### 10.3 测试环境与流程

- **测试环境**：使用与生产环境隔离的测试环境
- **CI/CD集成**：测试流程集成到CI/CD管道，确保每次提交后自动执行
- **测试报告**：生成详细的测试报告，包括测试覆盖率和失败用例
- **问题追踪**：建立完整的缺陷跟踪和管理流程

## 11. 文档与开发规范

### 11.1 项目文档要求

- **技术文档**：
  - 架构设计文档：详细说明系统架构、模块划分和交互关系
  - API接口文档：使用Swagger/OpenAPI规范生成API文档
  - 数据库设计文档：包含表结构、字段说明、索引设计和关系图
  - 部署文档：详细的环境配置和部署步骤
- **开发文档**：
  - 开发环境搭建指南：帮助新成员快速上手开发环境
  - 编码规范文档：统一的命名约定、代码风格和最佳实践
  - 常见问题解答（FAQ）：记录开发和运维过程中的常见问题及解决方案

### 11.2 代码注释规范

- **后端注释**：
  - 类和方法使用PHPDoc注释，包含功能描述、参数和返回值说明
  - 复杂业务逻辑添加行级注释，说明实现思路
  - 关键算法和优化点添加详细注释
- **前端注释**：
  - 组件、Hook和工具函数使用JSDoc注释
  - 复杂状态逻辑和业务流程添加注释说明
  - API调用和数据转换部分添加注释

这个项目需求文档涵盖了现代化个人网站的所有核心功能，同时考虑了性能优化、安全性、可维护性和部署便利性。