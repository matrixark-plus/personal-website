# 个人网站项目规划设计问答文档

## 1. 项目概述与技术选型

### Q1: 项目的核心目标是什么？
A: 开发一个现代化的个人网站，包含面向公众的用户界面和后台管理系统，用于展示个人作品、博客、笔记等内容，并提供用户交互功能。

### Q2: 为什么选择Next.js作为前端框架？
A: Next.js是一个基于React的现代化框架，具有以下优势：
- 优秀的SEO支持（服务端渲染）
- 快速的页面加载性能
- 简化的部署流程
- 强大的生态系统和社区支持
- 内置优化功能（代码分割、图片优化等）

### Q3: 为什么选择Hyperf作为后端框架？
A: Hyperf具有以下特点：
- 基于Swoole的高性能协程框架
- 支持高并发处理
- 丰富的组件生态
- 良好的扩展性
- **严格遵循PHP官方标准和Hyperf框架规范**

### Q4: 为什么选择hyperf-admin作为后台管理系统？
A: hyperf-admin具有以下优势：
- 专为Hyperf框架设计，集成度高
- 配置化开发，减少重复代码
- 提供丰富的业务组件
- 支持快速CRUD开发
- 前后端分离架构
- **完全符合Hyperf框架标准**

## 2. 功能模块设计

### Q5: 前端用户界面包含哪些主要页面？
A: 前端用户界面包含以下主要页面：
- 首页：个人简介展示
- 博客页面：支持分类和标签双层筛选，Markdown渲染
- 作品页面：支持分类筛选
- 笔记页面：以脑图形式展示，不提供传统列表
- 联系页面：联系方式表单
- 用户系统相关页面：注册、登录、个人资料等

### Q6: 后台管理系统有哪些核心功能模块？
A: 后台管理系统包含以下核心功能模块：
- 仪表板：网站统计数据展示
- 用户管理：用户列表查看、权限分配、状态管理
- 博客管理：博客文章增删改查、标签管理、状态管理
- 作品管理：作品增删改查、分类管理
- 笔记管理：脑图根节点管理、节点编辑、双向链接管理
- 评论管理：评论审核、删除
- 系统配置：网站参数设置

### Q7: 笔记系统的脑图功能如何实现？
A: 笔记系统的脑图功能设计如下：
- 完全以脑图为核心，不提供传统列表视图
- 支持根节点列表展示（标题+脑图截图）
- 双向链接支持，实现笔记间关联
- Markdown格式存储和渲染
- 支持多个独立根节点

### Q8: 博客系统的分类和标签筛选机制如何工作？
A: 博客系统的双层筛选机制：
- 第一层：按分类筛选，缩小内容范围到特定领域
- 第二层：在已选分类基础上，按标签进一步筛选
- 支持同时选择多个标签进行筛选
- 提供筛选结果统计和清除筛选功能

## 3. 用户权限体系

### Q9: 系统包含哪些用户角色？
A: 系统包含三种用户角色：
- 管理员：拥有所有权限，可以管理用户、内容、评论和系统配置
- 会员用户：可发布评论、订阅RSS、查看公开内容、管理个人资料
- 访客用户：仅可查看公开内容和订阅RSS

### Q10: 如何实现用户认证和权限控制？
A: 用户认证和权限控制通过以下方式实现：
- 使用JWT（JSON Web Token）进行用户身份验证
- 基于RBAC（基于角色的访问控制）模型
- 后端API通过中间件验证用户权限
- 前端根据用户角色显示相应功能

## 4. 技术实现细节

### Q11: 如何优化数据库连接以避免连接数无限扩大？
A: 通过协程连接池管理数据库连接：
- MySQL和Redis采用协程连接池
- 设置最大连接数20-50（根据ECS资源配置调整）
- 连接超时时间10秒，等待超时时间3秒
- 最大空闲时间60秒

### Q12: 布隆过滤器如何提升系统性能？
A: 布隆过滤器的作用：
- 快速过滤不存在的资源请求
- 减少后端处理压力
- 降低数据库查询次数
- 提高系统响应速度

### Q13: 限速机制如何保护系统资源？
A: 限速机制通过以下方式保护系统：
- 使用hyperf/rate-limit组件实现
- 通过Redis进行滑动窗口计数
- 防止恶意请求和DDoS攻击
- 保护服务器资源不被耗尽

### Q14: JWT令牌如何存储以加速响应？
A: JWT令牌存储策略：
- 将JWT令牌及其相关信息存储到Redis中
- 使用哈希结构存储令牌详情，提高查询效率
- 设置与JWT令牌相同的过期时间
- 验证时直接从Redis查询，避免重复计算

## 5. 部署架构

### Q15: 本地开发环境如何部署？
A: 本地开发环境部署方案：
- 使用Docker Compose编排所有服务
- 每个服务独立容器运行
- 通过docker-compose.yml统一管理
- 支持开发模式热重载和自动重启

### Q16: 线上ECS环境如何部署？
A: 线上ECS环境部署方案：
- 阿里云ECS单机部署模式
- 所有服务部署在同一台实例
- 通过systemd管理服务启停
- Nginx作为统一入口和反向代理
- SSL证书配置和安全加固

### Q17: 如何管理不同环境的配置？
A: 环境配置管理：
- 通过环境变量分离配置
- 开发环境使用.env.development
- 生产环境使用.env.production
- 实现不同环境的参数切换

## 6. 数据库设计

### Q18: 核心数据表有哪些？
A: 核心数据表包括：
- 用户表：存储用户基本信息、角色、状态
- 博客表：存储博客文章内容、状态、分类、标签关联
- 作品表：存储作品信息、图片链接、项目链接、分类
- 笔记表：存储笔记内容（Markdown格式）、公开状态
- 评论表：存储用户评论、审核状态
- 订阅表：存储RSS订阅信息

### Q19: 脑图相关表如何设计？
A: 脑图相关表设计：
- 脑图根节点表：存储脑图根节点信息、截图路径
- 脑图节点表：存储脑图节点信息、位置坐标
- 节点链接表：存储节点间链接关系

### Q20: 分类标签表如何设计？
A: 分类标签表设计：
- 博客分类表：存储博客分类信息
- 博客标签表：存储博客标签信息
- 博客标签关联表：存储博客与标签的关联关系

## 7. API接口设计

### Q21: 用户认证接口包含哪些功能？
A: 用户认证接口功能：
- 用户注册/登录接口
- JWT令牌生成与验证接口
- 用户信息获取/更新接口

### Q22: 内容管理接口包含哪些功能？
A: 内容管理接口功能：
- 博客文章增删改查接口
- 作品集增删改查接口
- 笔记增删改查接口
- 评论增删改查接口
- RSS订阅接口

### Q23: 脑图管理接口包含哪些功能？
A: 脑图管理接口功能：
- 脑图根节点管理接口
- 脑图数据获取接口
- 节点间链接管理接口

## 8. 性能监控与安全

### Q24: 系统需要监控哪些关键指标？
A: 关键监控指标：
- 系统资源使用率（CPU、内存、磁盘）
- 数据库连接池状态
- API响应时间和错误率
- Redis缓存命中率

### Q25: 系统采取了哪些安全措施？
A: 系统安全措施：
- JWT令牌安全存储和传输
- 用户密码加密存储
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护
- 访问频率限制
- 敏感信息过滤

### Q26: API接口采用哪些HTTP方法？
A: 为了简化API设计和提高一致性，系统API接口只采用GET和POST两种HTTP方法：
- GET方法用于数据查询操作，如获取列表、详情等只读操作
- POST方法用于数据创建、更新和删除操作
- 通过URL路径和参数区分不同操作类型
- 这种设计简化了客户端调用，降低了学习成本

### Q27: 后端API项目的代码分层是如何规划的？
A: 后端API项目采用经典的分层架构设计，基于Hyperf框架的特性，分为以下层次：

1. **控制器层（Controller Layer）**：
   - 负责接收HTTP请求，解析请求参数
   - 调用服务层处理业务逻辑
   - 返回HTTP响应给客户端
   - 处理请求验证和基本的参数校验

2. **服务层（Service Layer）**：
   - 实现核心业务逻辑
   - 处理事务管理
   - 协调多个数据访问对象的操作
   - 提供可重用的业务功能

3. **数据访问层（Repository/Model Layer）**：
   - 负责与数据库交互
   - 封装数据查询和持久化操作
   - 使用Hyperf的ORM进行数据库操作
   - 提供数据对象的增删改查功能

4. **中间件层（Middleware Layer）**：
   - 处理跨切面关注点（如认证、限流、日志等）
   - 请求预处理和响应后处理
   - 权限验证和安全控制

5. **工具层（Util/Helper Layer）**：
   - 提供通用的工具函数和辅助类
   - 处理文件操作、数据转换等通用功能

这种分层架构具有以下优势：
- 职责分离，便于维护和扩展
- 提高代码复用性
- 便于单元测试
- 降低各层之间的耦合度

### Q28: 如何处理前端参数与数据库字段的映射以保护数据库字段安全？
A: 为了保护数据库字段安全，系统采用多层映射机制来隔离前端参数与数据库字段：

1. **参数映射层（DTO/VO模式）**：
   - 使用数据传输对象（DTO）接收前端请求参数
   - DTO字段名与前端约定的参数名保持一致
   - 通过映射服务将DTO转换为数据库实体对象
   - 避免前端直接接触真实的数据库字段名

2. **字段映射策略**：
   - 前端使用语义化参数名（如：userName, userEmail）
   - 数据库使用实际字段名（如：username, email）
   - 服务层负责字段名转换和数据验证
   - 支持字段白名单机制，只处理允许的字段

3. **数据验证与过滤**：
   - 控制器层对前端参数进行初步验证
   - 服务层进行业务逻辑验证
   - 只允许预定义的字段进行操作
   - 过滤掉不安全或不必要的参数

4. **安全防护措施**：
   - 隐藏数据库真实结构
   - 防止SQL注入攻击
   - 避免批量赋值漏洞
   - 支持字段级别的权限控制

这种设计确保了数据库字段安全，即使前端参数被恶意分析，也无法直接获取数据库的真实结构。

### Q29: API响应如何封装以支持HTTP状态码与业务码？
A: 为了提供更好的开发体验和统一的错误处理机制，系统采用封装的API响应格式，同时支持HTTP状态码和业务码：

1. **统一响应结构**：
   - 所有API响应采用统一的JSON格式
   - 包含HTTP状态码和业务码双重标识
   - 提供清晰的成功/失败状态指示
   - 支持详细的错误信息和调试信息

2. **响应格式设计**：
   ```json
   {
     "success": true/false,        // 请求是否成功
     "code": 200,                  // 业务码
     "message": "操作成功",         // 响应消息
     "data": {},                   // 响应数据
     "timestamp": 1234567890,      // 时间戳
     "request_id": "uuid"          // 请求ID，用于追踪
   }
   ```

3. **HTTP状态码与业务码映射**：
   - HTTP状态码：表示HTTP层面的请求处理结果
   - 业务码：表示具体业务操作的结果状态
   - 两者结合提供更精确的错误定位

4. **业务码规范**：
   - 200系列：成功状态码
   - 400系列：客户端错误
   - 500系列：服务器错误
   - 自定义业务码：特定业务场景的状态码

5. **错误处理机制**：
   - 统一异常处理中间件
   - 详细的错误日志记录
   - 支持开发环境和生产环境的不同错误信息展示
   - 提供错误码对照表便于开发调试

这种封装方式使得前端开发更加规范，错误处理更加统一，便于后续维护和扩展。
